---
name: plan-tasks
description: Capture conversation planning into self-contained tasks at end of discussion
---

# Plan Tasks

Transform conversation planning and requirements into a markdown task list where each task is completely self-contained with all necessary context inline.

## Task Format

The task list is in `.llm/todo.md`.

NEVER use the `Read` tool on `.llm/todo.md`. Always interact with the task list exclusively through the Python scripts.

### Task States

- `[ ]` - Not started (ready to work on)
- `[x]` - Completed
- `[!]` - Blocked after failed attempt

### Standalone Context

Each task is extracted and executed in isolation. The `task_get.py` script extracts only one task at a time - it cannot see other tasks in the file. Therefore:

1. Every task must contain ALL context needed to implement it
2. Repeat shared context in every related task - if 5 tasks share the same background, repeat it 5 times
3. Never reference other tasks - phrases like "similar to task above" are useless
4. Include the full picture - source of inspiration, files involved, patterns to follow
5. If a plan file exists (e.g., `~/.claude/plans/*.md`), archive it locally **before** adding any tasks:
   - Create the `.llm/plans/` directory if it does not exist
   - Move the file from `~/.claude/plans/<auto-generated-name>.md` to `.llm/plans/<yyyy-mm-dd>-<descriptive-name>.md`
   - Choose a concise, meaningful name (e.g., `2025-12-04-thread-safety-tests.md`)
   - Include the archived `.llm/plans/` absolute path in each task

## Branch Name

Before adding tasks, determine the branch name to include in each task:

- **Continuation of existing work**: If `.llm/todo.md` already has tasks for the same work stream, use the current local branch name.
- **New work stream**: Choose a new branch name and specify it should be created from the upstream tracking branch. Determine the upstream branch in preference order: `upstream/main` > `upstream/master` > `origin/main` > `origin/master` (first that exists). Check with `git remote` and `git branch -r`.

Include the branch as an indented context line in each task:

- New work: `Branch: create \`feature/thread-safety-tests\` from \`upstream/main\``
- Continuation: `Branch: \`feature/thread-safety-tests\` (existing)`

## When to Use

Use this command at the **end of a planning conversation** when you have discussed requirements, approaches, and implementation details but have not started coding yet. This captures the conversation context into actionable tasks in `.llm/todo.md`.

## Input

The input is the current conversation where planning and requirements have been discussed. Transform the plans, ideas, and requirements from the discussion into self-contained tasks in a markdown checklist format, appended to `.llm/todo.md`.

## Task Writing Guidelines

Each task should be written so it can be read independently from `- [ ]` to the next `- [ ]` and contain:

1. **Full absolute paths** - Never use relative paths
2. **Exact class/function names** - Specify exact names of code elements
3. **Analogies to existing code** - Reference similar existing implementations
4. **Specific implementation details** - List concrete methods or operations
5. **Module/package context** - State which module or package the work belongs to
6. **Dependencies and prerequisites** - Note what needs to exist or be imported
7. **Expected outcomes** - Describe what success looks like

## Example

```markdown
- [ ] Create a new test class `SynchronizedBagTest` at `/Users/craig/projects/eclipse-collections/unit-tests-thread-safety/src/test/java/org/eclipse/collections/impl/bag/mutable/SynchronizedBagTest.java` to test thread-safety of `org.eclipse.collections.impl.bag.mutable.SynchronizedBag`. Similar to how `SynchronizedMutableListTest` covers `SynchronizedMutableList`, this should extend `SynchronizedTestTrait` and implement test traits like `SynchronizedCollectionTestTrait`, `SynchronizedMutableIterableTestTrait`, and `SynchronizedRichIterableTestTrait`. The test should verify that all public methods of SynchronizedBag properly synchronize on the lock object using the `assertSynchronized()` method. Include tests for bag-specific methods like `addOccurrences()`, `removeOccurrences()`, `occurrencesOf()`, `forEachWithOccurrences()`, and `toMapOfItemToCount()`.
```
